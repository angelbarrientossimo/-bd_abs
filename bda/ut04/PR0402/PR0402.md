------------- ESPECIALIZACIÓN EN INTELIGENCIA ARTIFICIAL Y BIG DATA -------------
---------------------------------------------------------------------------------

Módulo:                     BIG DATA APLICADO
Profesor:                   Víctor J. González
Unidad de Trabajo:          UT02. HDFS. Almacenamiento distribuido
Práctica:                   PR0402. Trabajando con datos del clima
Resultados de aprendizaje:  RA1

# PR0402: MapReduce (II)

En esta práctica vamos a trabajar con datos sobre el clima. Trabajaremos con un dataset ya limpio y organizado que podrás encontrar en Kaggle (https://www.kaggle.com/datasets/sudalairajkumar/daily-temperature-of-major-cities)

Si descargas este dataset en formato CSV verás que tiene los siguientes campos:

Region

Country

State

City

Month

Day

Year

AvgTemperature

Lo primero que vamos a hacer es crear una carpeta en la que guardar el documento **csv**


```python
!hdfs dfs -mkdir /practica
```

    mkdir: `/practica': File exists



```python
!hdfs dfs -put city_temperature.csv /practica
```

    put: `/practica/city_temperature.csv': File exists



```python
!hdfs dfs -ls /practica
```

    Found 1 items
    -rw-r--r--   3 root supergroup  140600832 2025-11-18 09:53 /practica/city_temperature.csv


# Ejercicio 1:

temperatura máxima por ciudad
Utiliza MapReduce para encontrar la temperatura máxima registrada para cada ciudad. Para ello tienes que tener en cuenta lo siguiente:

Lógica mapper: lee cada línea de los datos y emite el par (ciudad, temperatura)
Lógica reducer: como recibirá todas las líneas de una misma ciudad consecutivamente, emite únicamente la línea con mayor valor en temperatura.


```python
%%writefile mapper_ejercicio.py
#!/usr/bin/env python3


import os
import sys


for line in sys.stdin:
    # line = "Africa,Algeria,,Algiers,1,1,1995,64.2"
    line = line.strip()
    region, country, state, city, month, day, year, avg_temperature  = line.split(',')

    print( f"{city}\t{avg_temperature}")
#Lo que hacemos en realidad es crear una serie de pares clave-valor, que el shuffle ordena por clave y luego el reduce lo ejecuta
```

    Overwriting mapper_ejercicio.py



```python
%%writefile reducer_ejercicio.py
#!/usr/bin/env python3

import sys
ciudad_test = None
temperatura_test = None
for line in sys.stdin:
    city, avg_temperature = line.strip().split("\t",1)
    if ciudad_test is None:
        #Si la ciudad es la primera
        ciudad_test = city
        temperatura_test = avg_temperature
    if city == ciudad_test:
        #Misma ciudad, comprobar temperatura, en caso de ser mayor cambiarla
        if avg_temperature > temperatura_test:
            temperatura_test = avg_temperature
    else:
        #Distinta ciudad, imprimimos la anterior
        print(f"{ciudad_test}\t{temperatura_test}")
        #Seteamos las variables a las nuevas
        ciudad_test = city
        temperatura_test = avg_temperature
        
if ciudad_test is not None:
    #Ultima línea
    print(f"{ciudad_test}\t{temperatura_test}")

```

    Overwriting reducer_ejercicio.py



```python
# Simulamos para ver si funciona los scripts creados (El sort simula el shuffle)
!head -n 20 city_temperature.csv | python3 mapper_ejercicio.py | sort | python3 reducer_ejercicio.py

```

    Algiers	64.2
    City	AvgTemperature


Tras el simulacro, viendo que funciona lo ejecutamos con el Streaming


```python
!hadoop jar \
/usr/local/hadoop/share/hadoop/tools/lib/hadoop-streaming-3.4.0.jar \
-file mapper_ejercicio.py \
-file reducer_ejercicio.py \
-mapper mapper_ejercicio.py \
-reducer reducer_ejercicio.py \
-input /practica/city_temperature.csv \
-output /Temperatura_maxima
```

    2025-11-24 11:18:31,011 WARN streaming.StreamJob: -file option is deprecated, please use generic option -files instead.
    packageJobJar: [mapper_ejercicio.py, reducer_ejercicio.py, /tmp/hadoop-unjar9010381648470462810/] [] /tmp/streamjob4873406576536236374.jar tmpDir=null
    2025-11-24 11:18:31,589 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at yarnmanager/172.19.0.7:8032
    2025-11-24 11:18:31,677 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at yarnmanager/172.19.0.7:8032
    2025-11-24 11:18:31,810 INFO mapreduce.JobResourceUploader: Disabling Erasure Coding for path: /tmp/hadoop-yarn/staging/root/.staging/job_1763979698295_0003
    2025-11-24 11:18:32,073 INFO mapred.FileInputFormat: Total input files to process : 1
    2025-11-24 11:18:32,082 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.3:9866
    2025-11-24 11:18:32,082 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.4:9866
    2025-11-24 11:18:32,082 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.5:9866
    2025-11-24 11:18:32,082 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.6:9866
    2025-11-24 11:18:32,125 INFO mapreduce.JobSubmitter: number of splits:2
    2025-11-24 11:18:32,187 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1763979698295_0003
    2025-11-24 11:18:32,187 INFO mapreduce.JobSubmitter: Executing with tokens: []
    2025-11-24 11:18:32,286 INFO conf.Configuration: resource-types.xml not found
    2025-11-24 11:18:32,286 INFO resource.ResourceUtils: Unable to find 'resource-types.xml'.
    2025-11-24 11:18:32,327 INFO impl.YarnClientImpl: Submitted application application_1763979698295_0003
    2025-11-24 11:18:32,349 INFO mapreduce.Job: The url to track the job: http://yarnmanager:8088/proxy/application_1763979698295_0003/
    2025-11-24 11:18:32,350 INFO mapreduce.Job: Running job: job_1763979698295_0003
    2025-11-24 11:18:36,401 INFO mapreduce.Job: Job job_1763979698295_0003 running in uber mode : false
    2025-11-24 11:18:36,403 INFO mapreduce.Job:  map 0% reduce 0%
    2025-11-24 11:18:42,454 INFO mapreduce.Job:  map 100% reduce 0%
    2025-11-24 11:18:48,443 INFO mapreduce.Job:  map 100% reduce 100%
    2025-11-24 11:18:48,455 INFO mapreduce.Job: Job job_1763979698295_0003 completed successfully
    2025-11-24 11:18:48,515 INFO mapreduce.Job: Counters: 54
    	File System Counters
    		FILE: Number of bytes read=47411269
    		FILE: Number of bytes written=95765125
    		FILE: Number of read operations=0
    		FILE: Number of large read operations=0
    		FILE: Number of write operations=0
    		HDFS: Number of bytes read=140605132
    		HDFS: Number of bytes written=4542
    		HDFS: Number of read operations=11
    		HDFS: Number of large read operations=0
    		HDFS: Number of write operations=2
    		HDFS: Number of bytes read erasure-coded=0
    	Job Counters 
    		Launched map tasks=2
    		Launched reduce tasks=1
    		Data-local map tasks=2
    		Total time spent by all maps in occupied slots (ms)=6586
    		Total time spent by all reduces in occupied slots (ms)=3359
    		Total time spent by all map tasks (ms)=6586
    		Total time spent by all reduce tasks (ms)=3359
    		Total vcore-milliseconds taken by all map tasks=6586
    		Total vcore-milliseconds taken by all reduce tasks=3359
    		Total megabyte-milliseconds taken by all map tasks=6744064
    		Total megabyte-milliseconds taken by all reduce tasks=3439616
    	Map-Reduce Framework
    		Map input records=2906328
    		Map output records=2906328
    		Map output bytes=41598607
    		Map output materialized bytes=47411275
    		Input split bytes=204
    		Combine input records=0
    		Combine output records=0
    		Reduce input groups=322
    		Reduce shuffle bytes=47411275
    		Reduce input records=2906328
    		Reduce output records=322
    		Spilled Records=5812656
    		Shuffled Maps =2
    		Failed Shuffles=0
    		Merged Map outputs=2
    		GC time elapsed (ms)=278
    		CPU time spent (ms)=9070
    		Physical memory (bytes) snapshot=1259364352
    		Virtual memory (bytes) snapshot=7854682112
    		Total committed heap usage (bytes)=1331167232
    		Peak Map Physical memory (bytes)=566374400
    		Peak Map Virtual memory (bytes)=2615607296
    		Peak Reduce Physical memory (bytes)=408182784
    		Peak Reduce Virtual memory (bytes)=2626158592
    	Shuffle Errors
    		BAD_ID=0
    		CONNECTION=0
    		IO_ERROR=0
    		WRONG_LENGTH=0
    		WRONG_MAP=0
    		WRONG_REDUCE=0
    	File Input Format Counters 
    		Bytes Read=140604928
    	File Output Format Counters 
    		Bytes Written=4542
    2025-11-24 11:18:48,516 INFO streaming.StreamJob: Output directory: /Temperatura_maxima



```python
!hdfs dfs -ls /
```

    Found 6 items
    drwxr-xr-x   - root supergroup          0 2025-11-24 11:18 /Temperatura_maxima
    drwxr-xr-x   - root supergroup          0 2025-11-18 09:05 /indice_invertido
    drwxr-xr-x   - root supergroup          0 2025-11-18 09:53 /practica
    drwxr-xr-x   - root supergroup          0 2025-11-18 09:22 /salida_indice
    drwxrwx---   - root supergroup          0 2025-11-12 11:33 /tmp
    drwxrwxrwt   - root root                0 2025-11-24 10:32 /yarn



```python
!hdfs dfs -ls /Temperatura_maxima
```

    Found 2 items
    -rw-r--r--   3 root supergroup          0 2025-11-24 11:18 /Temperatura_maxima/_SUCCESS
    -rw-r--r--   3 root supergroup       4542 2025-11-24 11:18 /Temperatura_maxima/part-00000


Vemos que tenemos dos archivos generados del reducer, Estos son un _succes indicando que salio bien y part-00000 con el contenido de la salida


```python
!hdfs dfs -cat /Temperatura_maxima/part-00000
```

    Abidjan	88.6
    Abilene	94.2
    Abu Dhabi	99.9
    Addis Ababa	77.0
    Akron Canton	9.9
    Albany	9.9
    Albuquerque	89.4
    Algiers	96.6
    Allentown	91.1
    Almaty	90.9
    Amarillo	92.5
    Amman	95.4
    Amsterdam	85.5
    Anchorage	9.9
    Ankara	9.7
    Antananarivo	78.5
    Ashabad	99.9
    Asheville	9.7
    Athens	94.3
    Atlanta	92.8
    Atlantic City	93.3
    Auckland	75.4
    Austin	94.5
    Baltimore	91.9
    Bangkok	93.0
    Bangui	93.7
    Banjul	93.6
    Barcelona	86.6
    Baton Rouge	90.2
    Beijing	92.9
    Beirut	91.1
    Belfast	77.6
    Belgrade	91.9
    Belize City	92.9
    Bern	9.6
    Bilbao	94.6
    Billings	90.6
    Birmingham	91.0
    Bishkek	91.1
    Bismarck	91.7
    Bissau	96.0
    Bogota	66.7
    Boise	94.2
    Bombay (Mumbai)	92.6
    Bonn	86.9
    Bordeaux	88.8
    Boston	90.7
    Brasilia	87.7
    Bratislava	85.5
    Brazzaville	88.7
    Bridgeport	9.4
    Bridgetown	88.0
    Brisbane	87.3
    Brownsville	91.2
    Brussels	85.4
    Bucharest	91.4
    Budapest	9.7
    Buenos Aires	90.9
    Buffalo	9.9
    Bujumbura	89.1
    Burlington	9.9
    Cairo	98.9
    Calcutta	96.8
    Calgary	9.9
    Canberra	93.2
    Capetown	83.8
    Caracas	89.9
    Caribou	9.9
    Casper	9.9
    Charleston	91.6
    Charlotte	90.4
    Chattanooga	92.7
    Chengdu	90.6
    Chennai (Madras)	97.9
    Cheyenne	9.9
    Chicago	92.3
    Cincinnati	9.9
    City	AvgTemperature
    Cleveland	9.9
    Colombo	88.3
    Colorado Springs	9.9
    Columbia	92.8
    Columbus	97.7
    Conakry	89.6
    Concord	90.1
    Copenhagen	9.3
    Corpus Christi	93.0
    Cotonou	88.6
    Dakar	87.0
    Dallas Ft Worth	98.2
    Damascus	95.5
    Dar Es Salaam	90.4
    Dayton	91.2
    Daytona Beach	87.8
    Delhi	99.9
    Denver	9.8
    Des Moines	93.0
    Detroit	9.9
    Dhahran	99.9
    Dhaka	91.4
    Doha	99.9
    Dubai	99.9
    Dublin	70.1
    Duluth	9.9
    Dusanbe	97.6
    Edmonton	9.9
    El Paso	98.1
    Elkins	92.5
    Erie	9.9
    Eugene	85.4
    Evansville	91.5
    Fairbanks	9.9
    Fargo	91.4
    Flagstaff	83.5
    Flint	9.9
    Fort Smith	97.3
    Fort Wayne	9.9
    Frankfurt	85.2
    Freetown	88.7
    Fresno	98.7
    Geneva	85.2
    Georgetown	90.6
    Goodland	91.8
    Grand Junction	92.3
    Grand Rapids	9.9
    Great Falls	92.1
    Green Bay	91.3
    Greensboro	90.4
    Guadalajara	88.5
    Guangzhou	94.7
    Guatemala City	79.8
    Guayaquil	90.0
    Halifax	9.9
    Hamburg	89.8
    Hamilton	85.4
    Hanoi	96.0
    Harrisburg	92.0
    Hartford Springfield	9.9
    Havana	88.3
    Helena	9.9
    Helsinki	9.8
    Hong Kong	92.4
    Honolulu	87.2
    Houston	93.0
    Huntsville	91.5
    Indianapolis	94.0
    Islamabad	99.9
    Istanbul	88.7
    Jackson	89.6
    Jacksonville	88.3
    Jakarta	90.6
    Juneau	9.9
    Kampala	82.9
    Kansas City	92.6
    Karachi	99.7
    Katmandu	86.6
    Kiev	9.9
    Knoxville	91.7
    Kuala Lumpur	89.6
    Kuwait	99.9
    La Paz	63.4
    Lagos	93.2
    Lake Charles	94.0
    Lansing	9.9
    Las Vegas	99.9
    Lexington	9.9
    Libreville	86.8
    Lilongwe	90.7
    Lima	81.8
    Lincoln	91.9
    Lisbon	96.3
    Little Rock	95.4
    Lome	90.1
    London	83.4
    Los Angeles	86.0
    Louisville	93.2
    Lubbock	94.1
    Lusaka	93.2
    Macon	91.1
    Madison	90.6
    Madrid	91.0
    Managua	93.9
    Manama	99.9
    Manila	91.9
    Maputo	95.6
    Medford	97.3
    Melbourne	92.8
    Memphis	93.6
    Mexico City	77.0
    Miami Beach	89.2
    Midland Odessa	94.6
    Milan	87.4
    Milwaukee	92.2
    Minneapolis St. Paul	92.0
    Minsk	9.9
    Mobile	88.9
    Monterrey	99.6
    Montgomery	91.2
    Montreal	9.9
    Montvideo	87.4
    Moscow	9.9
    Munich	9.8
    Muscat	99.9
    Nairobi	82.4
    Nashville	94.1
    Nassau	91.8
    New Orleans	90.1
    New York City	93.7
    Newark	95.6
    Niamey	99.9
    Nicosia	98.6
    Norfolk	93.2
    North Platte	91.1
    Nouakchott	99.5
    Oklahoma City	97.1
    Omaha	93.2
    Orlando	89.3
    Osaka	93.0
    Oslo	9.9
    Ottawa	9.9
    Paducah	91.8
    Panama City	90.6
    Paramaribo	90.5
    Paris	91.5
    Peoria	90.5
    Perth	95.2
    Philadelphia	92.9
    Phoenix	99.9
    Pittsburgh	9.9
    Pocatello	90.4
    Port au Prince	97.4
    Portland	9.9
    Prague	9.9
    Pristina	9.4
    Pueblo	94.7
    Pyongyang	9.9
    Quebec	9.9
    Quito	69.0
    Rabat	97.0
    Raleigh Durham	91.0
    Rangoon	99.3
    Rapid City	91.9
    Regina	9.9
    Reno	92.8
    Reykjavik	69.7
    Rhode Island	9.8
    Richmond	93.5
    Riga	9.9
    Rio de Janeiro	93.4
    Riyadh	99.9
    Roanoke	91.1
    Rochester	9.9
    Rockford	90.6
    Rome	85.8
    Sacramento	96.3
    Salem	90.5
    Salt Lake City	92.2
    San Angelo	96.3
    San Antonio	95.4
    San Diego	86.5
    San Francisco	82.7
    San Jose	85.6
    San Juan Puerto Rico	89.2
    Santo Domingo	87.4
    Sao Paulo	89.2
    Sapporo	9.9
    Sault Ste Marie	9.9
    Savannah	89.1
    Seattle	87.7
    Seoul	90.0
    Shanghai	96.8
    Shenyang	90.7
    Shreveport	95.4
    Singapore	88.5
    Sioux City	90.7
    Sioux Falls	94.3
    Skopje	9.2
    Sofia	9.8
    South Bend	9.9
    Spokane	93.2
    Springfield	92.8
    St Louis	96.3
    Stockholm	9.7
    Sydney	96.8
    Syracuse	9.9
    Taipei	94.0
    Tallahassee	92.8
    Tampa St. Petersburg	90.8
    Tashkent	95.4
    Tbilisi	90.6
    Tegucigalpa	88.0
    Tel Aviv	88.5
    Tirana	92.5
    Tokyo	90.6
    Toledo	9.9
    Topeka	95.6
    Toronto	9.9
    Tucson	99.4
    Tulsa	99.6
    Tunis	96.4
    Tupelo	92.8
    Ulan-bator	9.9
    Vancouver	83.1
    Vienna	9.9
    Vientiane	97.0
    Waco	96.1
    Warsaw	9.9
    Washington	92.8
    Washington DC	92.8
    West Palm Beach	89.3
    Wichita	96.1
    Wichita Falls	98.5
    Wilkes Barre	9.9
    Wilmington	89.7
    Windhoek	92.2
    Winnipeg	9.9
    Yakima	97.7
    Yerevan	91.8
    Youngstown	9.9
    Yuma	99.9
    Zagreb	87.5
    Zurich	9.8


# Ejercicio 2:

media histórica por país
Calcula la temperatura media histórica para cada país. El proceso es similar al anterior, en el reducer debes ir recordando todos los datos que te lleguen de un mismo país y, cuando pase al siguiente país, calcular la media y emitirlos.

Creamos el mapper



```python
%%writefile mapper_ejercicio2.py
#!/usr/bin/env python3


import os
import sys


for line in sys.stdin:
    # line = "Africa,Algeria,,Algiers,1,1,1995,64.2"
    line = line.strip()
    region, country, state, city, month, day, year, avg_temperature  = line.split(',')

    print( f"{country}\t{avg_temperature}")
#Creamos una serie de pares claves-valor country-temperatura
```

    Overwriting mapper_ejercicio2.py


Creamos el reducer


```python
%%writefile reducer_ejercicio2.py
#!/usr/bin/env python3

import sys
country_test = None
temperatura_test = 0
contador = 0
for line in sys.stdin:
    country, avg_temperature = line.strip().split("\t",1)
    if avg_temperature == "AvgTemperature":
        #Hacemos esto para que la cabecera la salte
        continue
    else:
        avg_temperature = float(avg_temperature)

    if country_test is None:
        #Si el pais es la primera iteracción
        country_test = country
    if country == country_test:
        #Mismo pais, almacenar temperatura (Como la primera vez tmb coincidira, seteamos aqui)
        contador += 1
        temperatura_test = temperatura_test + avg_temperature
    else:
        #Distinto pais, imprimimos la anterior y su temperatura
        temperatura_test = temperatura_test / contador
        print(f"{country_test}\t{temperatura_test}")
        #Seteamos las variables a las nuevas
        country_test = country
        temperatura_test = avg_temperature
        contador =  1
        
if country_test is not None:
    #Ultima línea
    temperatura_test = temperatura_test / contador
    print(f"{country_test}\t{temperatura_test}")

```

    Overwriting reducer_ejercicio2.py


Comprobamos simulando con el sort


```python
# Simulamos para ver si funciona los scripts creados (El sort simula el shuffle)
!head -n 30000 city_temperature.csv | python3 mapper_ejercicio2.py | sort | python3 reducer_ejercicio2.py
```

    Algeria	63.755439240232874
    Benin	76.15212605223378
    Burundi	-65.39713845476525
    Central African Republic	64.49786250722134


Viendo que funciona, lo hacemos "en STREAMING"


```python
!hadoop jar \
/usr/local/hadoop/share/hadoop/tools/lib/hadoop-streaming-3.4.0.jar \
-file mapper_ejercicio2.py \
-file reducer_ejercicio2.py \
-mapper mapper_ejercicio2.py \
-reducer reducer_ejercicio2.py \
-input /practica/city_temperature.csv \
-output /Temperatura_media_pais
```

    2025-11-24 11:19:16,612 WARN streaming.StreamJob: -file option is deprecated, please use generic option -files instead.
    packageJobJar: [mapper_ejercicio2.py, reducer_ejercicio2.py, /tmp/hadoop-unjar4786394322955601726/] [] /tmp/streamjob4215736668411693545.jar tmpDir=null
    2025-11-24 11:19:17,101 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at yarnmanager/172.19.0.7:8032
    2025-11-24 11:19:17,173 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at yarnmanager/172.19.0.7:8032
    2025-11-24 11:19:17,332 INFO mapreduce.JobResourceUploader: Disabling Erasure Coding for path: /tmp/hadoop-yarn/staging/root/.staging/job_1763979698295_0004
    2025-11-24 11:19:17,622 INFO mapred.FileInputFormat: Total input files to process : 1
    2025-11-24 11:19:17,632 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.5:9866
    2025-11-24 11:19:17,633 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.3:9866
    2025-11-24 11:19:17,633 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.4:9866
    2025-11-24 11:19:17,633 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.6:9866
    2025-11-24 11:19:17,677 INFO mapreduce.JobSubmitter: number of splits:2
    2025-11-24 11:19:17,753 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1763979698295_0004
    2025-11-24 11:19:17,753 INFO mapreduce.JobSubmitter: Executing with tokens: []
    2025-11-24 11:19:17,881 INFO conf.Configuration: resource-types.xml not found
    2025-11-24 11:19:17,882 INFO resource.ResourceUtils: Unable to find 'resource-types.xml'.
    2025-11-24 11:19:17,927 INFO impl.YarnClientImpl: Submitted application application_1763979698295_0004
    2025-11-24 11:19:17,949 INFO mapreduce.Job: The url to track the job: http://yarnmanager:8088/proxy/application_1763979698295_0004/
    2025-11-24 11:19:17,950 INFO mapreduce.Job: Running job: job_1763979698295_0004
    2025-11-24 11:19:22,956 INFO mapreduce.Job: Job job_1763979698295_0004 running in uber mode : false
    2025-11-24 11:19:22,956 INFO mapreduce.Job:  map 0% reduce 0%
    2025-11-24 11:19:28,006 INFO mapreduce.Job:  map 100% reduce 0%
    2025-11-24 11:19:34,039 INFO mapreduce.Job:  map 100% reduce 100%
    2025-11-24 11:19:35,061 INFO mapreduce.Job: Job job_1763979698295_0004 completed successfully
    2025-11-24 11:19:35,118 INFO mapreduce.Job: Counters: 54
    	File System Counters
    		FILE: Number of bytes read=37383747
    		FILE: Number of bytes written=75710120
    		FILE: Number of read operations=0
    		FILE: Number of large read operations=0
    		FILE: Number of write operations=0
    		HDFS: Number of bytes read=140605132
    		HDFS: Number of bytes written=3392
    		HDFS: Number of read operations=11
    		HDFS: Number of large read operations=0
    		HDFS: Number of write operations=2
    		HDFS: Number of bytes read erasure-coded=0
    	Job Counters 
    		Launched map tasks=2
    		Launched reduce tasks=1
    		Data-local map tasks=2
    		Total time spent by all maps in occupied slots (ms)=6031
    		Total time spent by all reduces in occupied slots (ms)=3497
    		Total time spent by all map tasks (ms)=6031
    		Total time spent by all reduce tasks (ms)=3497
    		Total vcore-milliseconds taken by all map tasks=6031
    		Total vcore-milliseconds taken by all reduce tasks=3497
    		Total megabyte-milliseconds taken by all map tasks=6175744
    		Total megabyte-milliseconds taken by all reduce tasks=3580928
    	Map-Reduce Framework
    		Map input records=2906328
    		Map output records=2906328
    		Map output bytes=31571085
    		Map output materialized bytes=37383753
    		Input split bytes=204
    		Combine input records=0
    		Combine output records=0
    		Reduce input groups=126
    		Reduce shuffle bytes=37383753
    		Reduce input records=2906328
    		Reduce output records=125
    		Spilled Records=5812656
    		Shuffled Maps =2
    		Failed Shuffles=0
    		Merged Map outputs=2
    		GC time elapsed (ms)=174
    		CPU time spent (ms)=6680
    		Physical memory (bytes) snapshot=941477888
    		Virtual memory (bytes) snapshot=7850074112
    		Total committed heap usage (bytes)=1002438656
    		Peak Map Physical memory (bytes)=284196864
    		Peak Map Virtual memory (bytes)=2614734848
    		Peak Reduce Physical memory (bytes)=377761792
    		Peak Reduce Virtual memory (bytes)=2621444096
    	Shuffle Errors
    		BAD_ID=0
    		CONNECTION=0
    		IO_ERROR=0
    		WRONG_LENGTH=0
    		WRONG_MAP=0
    		WRONG_REDUCE=0
    	File Input Format Counters 
    		Bytes Read=140604928
    	File Output Format Counters 
    		Bytes Written=3392
    2025-11-24 11:19:35,118 INFO streaming.StreamJob: Output directory: /Temperatura_media_pais


Comprobamos que ha salido todo correcto

Es decir que buscamos los archivos generados, el success y vemos el contenido de part-00000


```python
!hdfs dfs -ls /Temperatura_media_pais
```

    Found 2 items
    -rw-r--r--   3 root supergroup          0 2025-11-24 11:19 /Temperatura_media_pais/_SUCCESS
    -rw-r--r--   3 root supergroup       3392 2025-11-24 11:19 /Temperatura_media_pais/part-00000



```python
!hdfs dfs -cat /Temperatura_media_pais/part-00000
```

    Albania	33.17292251241107
    Algeria	63.755439240233265
    Argentina	62.30489963306701
    Australia	61.63429311461293
    Austria	51.04722641916682
    Bahamas	76.57303831624394
    Bahrain	80.63559248866818
    Bangladesh	10.109879518072237
    Barbados	77.00251697494743
    Belarus	41.82123272884276
    Belgium	51.05704726958779
    Belize	73.47807405808089
    Benin	76.15212605223395
    Bermuda	66.97127603710847
    Bolivia	44.8671487157349
    Brazil	70.13152498471065
    Bulgaria	45.203345564429185
    Burundi	-65.39713845476528
    Canada	42.005247491413456
    Central African Republic	67.01951219512232
    China	59.9836754516616
    Colombia	55.24395639974096
    Congo	69.31744198596876
    Costa Rica	70.37572846967407
    Croatia	46.92861305990303
    Cuba	72.64080310880819
    Cyprus	23.777476999292325
    Czech Republic	47.60325922728247
    Denmark	46.960446794733414
    Dominican Republic	65.21575822989745
    Egypt	71.95347507014897
    Equador	59.94560884271567
    Ethiopia	25.455255513717063
    Finland	42.24399956831425
    France	54.69657349449593
    Gabon	70.39779792746077
    Gambia	59.665827085285535
    Georgia	46.51603471904989
    Germany	6.421902994108629
    Greece	59.633870722433265
    Guatemala	56.91135333477212
    Guinea	49.38939132311692
    Guinea-Bissau	2.392121735376626
    Guyana	-22.101520236920035
    Haiti	16.68519637462239
    Honduras	68.53149487317846
    Hong Kong	75.0627778976906
    Hungary	51.09906108353103
    Iceland	41.082764947118534
    India	79.76246121468732
    Indonesia	35.98840798704798
    Ireland	49.0667817828619
    Israel	54.02044817927186
    Italy	57.21037124973017
    Ivory Coast	75.13995251456926
    Japan	55.85347147276793
    Jordan	64.16010144614732
    Kazakhstan	49.319838100377694
    Kenya	23.452060975609765
    Kuwait	79.49446363047706
    Kyrgyzstan	51.37300000000041
    Laos	79.96746168789139
    Latvia	44.136423483703844
    Lebanon	69.39838117850232
    Macedonia	54.007803561791775
    Madagascar	63.445898985538356
    Malawi	-20.585543650096575
    Malaysia	78.95312972156239
    Mauritania	73.41478705686407
    Mexico	47.615236724602575
    Mongolia	29.695078782646313
    Morocco	62.73345564429088
    Mozambique	62.783186316695556
    Myanmar (Burma)	71.51167709907165
    Namibia	57.99034103172874
    Nepal	49.4923475445224
    New Zealand	58.91374919058926
    Nicaragua	71.8512817739317
    Nigeria	61.99154625961306
    North Korea	48.21019857543702
    Norway	40.923372044794604
    Oman	21.88897611304244
    Pakistan	71.6510145709658
    Panama	79.57879343837666
    Peru	66.63344696473037
    Philippines	81.54242391538949
    Poland	47.77608461040342
    Portugal	61.85777034319008
    Qatar	82.2356248650983
    Romania	52.36450464062175
    Russia	44.96580211335247
    Saudi Arabia	79.15030218001289
    Senegal	75.55507230736012
    Serbia-Montenegro	42.39676101546542
    Sierra Leone	-9.820260911579924
    Singapore	81.65440319447447
    Slovakia	51.44646017699106
    South Africa	61.94041657673202
    South Korea	52.87797323548463
    Spain	59.46831786459405
    Sri Lanka	74.24142024606074
    Suriname	47.51491152352201
    Sweden	45.093503129721725
    Switzerland	49.82939779840276
    Syria	62.806119805720385
    Taiwan	69.33387653788023
    Tajikistan	35.15456507662428
    Tanzania	65.30484079173851
    Thailand	72.4640858815876
    The Netherlands	50.818076840060414
    Togo	71.56976041441825
    Tunisia	66.47864234837043
    Turkey	55.1784103172892
    Turkmenistan	62.04968702784378
    US	56.122331940987806
    Uganda	44.14252563410687
    Ukraine	47.66315562270658
    United Arab Emirates	82.58256529246727
    United Kingdom	51.00676667386163
    Uruguay	60.9748650982086
    Uzbekistan	58.806345780272224
    Venezuela	78.32601187263903
    Vietnam	74.73731923159943
    Yugoslavia	54.032840492121686
    Zambia	55.90346164895145


# Ejercicio 3: 

conteo de días calurosos por ciudad
Calcula cuántos días calurosos (definidos como >30 grados) hubo en cada año en cada ciudad.


```python
%%writefile mapper_ejercicio3.py
#!/usr/bin/env python3


import os
import sys


for line in sys.stdin:
    # line = "Africa,Algeria,,Algiers,1,1,1995,64.2"
    line = line.strip()
    region, country, state, city, month, day, year, avg_temperature  = line.split(',')

    print( f"{city}\t{avg_temperature}")
#Creamos una serie de pares claves-valor city-temperatura
```

    Writing mapper_ejercicio3.py



```python
%%writefile reducer_ejercicio3.py
#!/usr/bin/env python3

import sys
city_test = None
contador = 0
for line in sys.stdin:
    city, avg_temperature = line.strip().split("\t",1)
    if avg_temperature == "AvgTemperature":
        #Hacemos esto para que la cabecera la salte
        continue
    else:
        avg_temperature = float(avg_temperature)
    if city_test is None:
        #Si el pais es la primera iteracción
       city_test = city
    if city == city_test:
        #Mismo pais, mirar si temp < 30(Como la primera vez tmb coincidira, seteamos aqui)
        if avg_temperature > 30:
            contador += 1

    else:
        #Distinto pais, imprimimos la anterior y su temperatura
        
        print(f"{city_test}\t{contador}")
        #Seteamos las variables a las nuevas
        city_test = city
        contador =  0
        
if city_test is not None:
    #Ultima línea
    print(f"{city_test}\t{contador}")
```

    Overwriting reducer_ejercicio3.py


Comprobamos el funcionamiento con una simulación


```python
# Simulamos para ver si funciona los scripts creados (El sort simula el shuffle)
!head -n 30000 city_temperature.csv | python3 mapper_ejercicio3.py | sort | python3 reducer_ejercicio3.py
```

    Algiers	9231
    Bangui	6371
    Bujumbura	884
    Cotonou	8981


Una vez comprobado, lo hacemos en "STREAMING"


```python
!hadoop jar \
/usr/local/hadoop/share/hadoop/tools/lib/hadoop-streaming-3.4.0.jar \
-file mapper_ejercicio3.py \
-file reducer_ejercicio3.py \
-mapper mapper_ejercicio3.py \
-reducer reducer_ejercicio3.py \
-input /practica/city_temperature.csv \
-output /Temperatura_30_ciudad
```

    2025-11-24 11:29:20,162 WARN streaming.StreamJob: -file option is deprecated, please use generic option -files instead.
    packageJobJar: [mapper_ejercicio3.py, reducer_ejercicio3.py, /tmp/hadoop-unjar7506570007655945242/] [] /tmp/streamjob2078122315702289555.jar tmpDir=null
    2025-11-24 11:29:20,716 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at yarnmanager/172.19.0.7:8032
    2025-11-24 11:29:20,789 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at yarnmanager/172.19.0.7:8032
    2025-11-24 11:29:20,932 INFO mapreduce.JobResourceUploader: Disabling Erasure Coding for path: /tmp/hadoop-yarn/staging/root/.staging/job_1763979698295_0005
    2025-11-24 11:29:21,250 INFO mapred.FileInputFormat: Total input files to process : 1
    2025-11-24 11:29:21,259 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.3:9866
    2025-11-24 11:29:21,259 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.5:9866
    2025-11-24 11:29:21,259 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.4:9866
    2025-11-24 11:29:21,259 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.6:9866
    2025-11-24 11:29:21,306 INFO mapreduce.JobSubmitter: number of splits:2
    2025-11-24 11:29:21,369 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1763979698295_0005
    2025-11-24 11:29:21,369 INFO mapreduce.JobSubmitter: Executing with tokens: []
    2025-11-24 11:29:21,469 INFO conf.Configuration: resource-types.xml not found
    2025-11-24 11:29:21,469 INFO resource.ResourceUtils: Unable to find 'resource-types.xml'.
    2025-11-24 11:29:21,520 INFO impl.YarnClientImpl: Submitted application application_1763979698295_0005
    2025-11-24 11:29:21,553 INFO mapreduce.Job: The url to track the job: http://yarnmanager:8088/proxy/application_1763979698295_0005/
    2025-11-24 11:29:21,554 INFO mapreduce.Job: Running job: job_1763979698295_0005
    2025-11-24 11:29:25,610 INFO mapreduce.Job: Job job_1763979698295_0005 running in uber mode : false
    2025-11-24 11:29:25,610 INFO mapreduce.Job:  map 0% reduce 0%
    2025-11-24 11:29:30,668 INFO mapreduce.Job:  map 100% reduce 0%
    2025-11-24 11:29:36,709 INFO mapreduce.Job:  map 100% reduce 100%
    2025-11-24 11:29:37,731 INFO mapreduce.Job: Job job_1763979698295_0005 completed successfully
    2025-11-24 11:29:37,791 INFO mapreduce.Job: Counters: 55
    	File System Counters
    		FILE: Number of bytes read=47411269
    		FILE: Number of bytes written=95765158
    		FILE: Number of read operations=0
    		FILE: Number of large read operations=0
    		FILE: Number of write operations=0
    		HDFS: Number of bytes read=140605132
    		HDFS: Number of bytes written=4594
    		HDFS: Number of read operations=11
    		HDFS: Number of large read operations=0
    		HDFS: Number of write operations=2
    		HDFS: Number of bytes read erasure-coded=0
    	Job Counters 
    		Launched map tasks=2
    		Launched reduce tasks=1
    		Data-local map tasks=1
    		Rack-local map tasks=1
    		Total time spent by all maps in occupied slots (ms)=6445
    		Total time spent by all reduces in occupied slots (ms)=3589
    		Total time spent by all map tasks (ms)=6445
    		Total time spent by all reduce tasks (ms)=3589
    		Total vcore-milliseconds taken by all map tasks=6445
    		Total vcore-milliseconds taken by all reduce tasks=3589
    		Total megabyte-milliseconds taken by all map tasks=6599680
    		Total megabyte-milliseconds taken by all reduce tasks=3675136
    	Map-Reduce Framework
    		Map input records=2906328
    		Map output records=2906328
    		Map output bytes=41598607
    		Map output materialized bytes=47411275
    		Input split bytes=204
    		Combine input records=0
    		Combine output records=0
    		Reduce input groups=322
    		Reduce shuffle bytes=47411275
    		Reduce input records=2906328
    		Reduce output records=321
    		Spilled Records=5812656
    		Shuffled Maps =2
    		Failed Shuffles=0
    		Merged Map outputs=2
    		GC time elapsed (ms)=303
    		CPU time spent (ms)=8680
    		Physical memory (bytes) snapshot=1220612096
    		Virtual memory (bytes) snapshot=7851614208
    		Total committed heap usage (bytes)=1318060032
    		Peak Map Physical memory (bytes)=568995840
    		Peak Map Virtual memory (bytes)=2615017472
    		Peak Reduce Physical memory (bytes)=367292416
    		Peak Reduce Virtual memory (bytes)=2623320064
    	Shuffle Errors
    		BAD_ID=0
    		CONNECTION=0
    		IO_ERROR=0
    		WRONG_LENGTH=0
    		WRONG_MAP=0
    		WRONG_REDUCE=0
    	File Input Format Counters 
    		Bytes Read=140604928
    	File Output Format Counters 
    		Bytes Written=4594
    2025-11-24 11:29:37,791 INFO streaming.StreamJob: Output directory: /Temperatura_30_ciudad



```python
!hdfs dfs -ls /Temperatura_30_ciudad
```

    Found 2 items
    -rw-r--r--   3 root supergroup          0 2025-11-24 11:29 /Temperatura_30_ciudad/_SUCCESS
    -rw-r--r--   3 root supergroup       4594 2025-11-24 11:29 /Temperatura_30_ciudad/part-00000



```python
!hdfs dfs -cat /Temperatura_30_ciudad/part-00000
```

    Abidjan	9002
    Abilene	9090
    Abu Dhabi	9231
    Addis Ababa	7142
    Akron Canton	7780
    Albany	7630
    Albuquerque	8982
    Algiers	9230
    Allentown	8201
    Almaty	7300
    Amarillo	8702
    Amman	9233
    Amsterdam	8990
    Anchorage	6096
    Ankara	8391
    Antananarivo	9152
    Ashabad	8931
    Asheville	8842
    Athens	6347
    Atlanta	9125
    Atlantic City	8585
    Auckland	9206
    Austin	9204
    Baltimore	8627
    Bangkok	5762
    Bangui	8650
    Banjul	7608
    Barcelona	9235
    Baton Rouge	5740
    Beijing	7857
    Beirut	9215
    Belfast	9174
    Belgrade	8602
    Belize City	8866
    Bern	8535
    Bilbao	9237
    Billings	7621
    Birmingham	9121
    Bishkek	6982
    Bismarck	6499
    Bissau	5181
    Bogota	9195
    Boise	8463
    Bombay (Mumbai)	9235
    Bonn	1029
    Bordeaux	9175
    Boston	8250
    Brasilia	9205
    Bratislava	8478
    Brazzaville	8801
    Bridgeport	8385
    Bridgetown	8348
    Brisbane	9229
    Brownsville	9247
    Brussels	8960
    Bucharest	8307
    Budapest	8310
    Buenos Aires	9230
    Buffalo	7570
    Bujumbura	884
    Burlington	7232
    Cairo	9226
    Calcutta	9224
    Calgary	5085
    Canberra	9216
    Capetown	9231
    Caracas	9120
    Caribou	6358
    Casper	7335
    Charleston	17770
    Charlotte	9106
    Chattanooga	9058
    Chengdu	9208
    Chennai (Madras)	9236
    Cheyenne	7602
    Chicago	7727
    Cincinnati	8305
    Cleveland	7925
    Colombo	8896
    Colorado Springs	7994
    Columbia	9196
    Columbus	17350
    Conakry	7613
    Concord	7338
    Copenhagen	8561
    Corpus Christi	9247
    Cotonou	8980
    Dakar	9224
    Dallas Ft Worth	9152
    Damascus	9204
    Dar Es Salaam	8570
    Dayton	7985
    Daytona Beach	5698
    Delhi	9204
    Denver	7953
    Des Moines	7569
    Detroit	7751
    Dhahran	9186
    Dhaka	3566
    Doha	9228
    Dubai	9232
    Dublin	9200
    Duluth	6216
    Dusanbe	7566
    Edmonton	4963
    El Paso	9222
    Elkins	8004
    Erie	7812
    Eugene	9130
    Evansville	8539
    Fairbanks	4802
    Fargo	6338
    Flagstaff	3108
    Flint	7496
    Fort Smith	8994
    Fort Wayne	7753
    Frankfurt	2199
    Freetown	3064
    Fresno	9248
    Geneva	8908
    Georgetown	2136
    Goodland	7930
    Grand Junction	8103
    Grand Rapids	7527
    Great Falls	7448
    Green Bay	7038
    Greensboro	8962
    Guadalajara	5180
    Guangzhou	9234
    Guatemala City	8709
    Guayaquil	9035
    Halifax	5541
    Hamburg	4013
    Hamilton	5557
    Hanoi	9229
    Harrisburg	5179
    Hartford Springfield	7990
    Havana	9093
    Helena	7334
    Helsinki	7276
    Hong Kong	9235
    Honolulu	9246
    Houston	9231
    Huntsville	9050
    Indianapolis	8078
    Islamabad	8931
    Istanbul	9200
    Jackson	9177
    Jacksonville	9232
    Jakarta	6857
    Juneau	7871
    Kampala	7728
    Kansas City	8173
    Karachi	9143
    Katmandu	8335
    Kiev	7695
    Knoxville	8935
    Kuala Lumpur	9094
    Kuwait	9210
    La Paz	9224
    Lagos	6036
    Lake Charles	9235
    Lansing	7422
    Las Vegas	9248
    Lexington	8446
    Libreville	8772
    Lilongwe	2641
    Lima	7605
    Lincoln	7711
    Lisbon	9221
    Little Rock	9060
    Lome	8755
    London	9197
    Los Angeles	9250
    Louisville	8622
    Lubbock	8957
    Lusaka	6377
    Macon	9199
    Madison	7224
    Madrid	9220
    Managua	8736
    Manama	9235
    Manila	9223
    Maputo	8655
    Medford	9151
    Melbourne	9229
    Memphis	9032
    Mexico City	9229
    Miami Beach	9241
    Midland Odessa	9121
    Milan	8980
    Milwaukee	7509
    Minneapolis St. Paul	6894
    Minsk	7224
    Mobile	9225
    Monterrey	9227
    Montgomery	9190
    Montreal	4241
    Montvideo	9228
    Moscow	6737
    Munich	8891
    Muscat	5924
    Nairobi	6030
    Nashville	8891
    Nassau	9160
    New Orleans	9228
    New York City	8639
    Newark	8561
    Niamey	9064
    Nicosia	4156
    Norfolk	9092
    North Platte	7474
    Nouakchott	8182
    Oklahoma City	8860
    Omaha	7637
    Orlando	9238
    Osaka	9232
    Oslo	7418
    Ottawa	5150
    Paducah	8663
    Panama City	9191
    Paramaribo	7598
    Paris	9045
    Peoria	7864
    Perth	9092
    Philadelphia	8648
    Phoenix	9241
    Pittsburgh	7989
    Pocatello	7605
    Port au Prince	5815
    Portland	16742
    Prague	8207
    Pristina	2878
    Pueblo	8145
    Pyongyang	7342
    Quebec	6368
    Quito	6593
    Rabat	9228
    Raleigh Durham	9055
    Rangoon	8733
    Rapid City	7341
    Regina	5715
    Reno	8787
    Reykjavik	8107
    Rhode Island	8233
    Richmond	8925
    Riga	7765
    Rio de Janeiro	9115
    Riyadh	9230
    Roanoke	8848
    Rochester	7592
    Rockford	7440
    Rome	9236
    Sacramento	9246
    Salem	9131
    Salt Lake City	8296
    San Angelo	9169
    San Antonio	9234
    San Diego	9251
    San Francisco	9228
    San Jose	9129
    San Juan Puerto Rico	6087
    Santo Domingo	8512
    Sao Paulo	9173
    Sapporo	6922
    Sault Ste Marie	6479
    Savannah	9215
    Seattle	9186
    Seoul	7928
    Shanghai	9197
    Shenyang	6642
    Shreveport	9201
    Singapore	9235
    Sioux City	7277
    Sioux Falls	6897
    Skopje	8659
    Sofia	7979
    South Bend	7654
    Spokane	8019
    Springfield	16563
    St Louis	8482
    Stockholm	7927
    Sydney	9231
    Syracuse	7546
    Taipei	9021
    Tallahassee	9222
    Tampa St. Petersburg	9237
    Tashkent	8712
    Tbilisi	4005
    Tegucigalpa	9094
    Tel Aviv	4195
    Tirana	7635
    Tokyo	9236
    Toledo	7764
    Topeka	8258
    Toronto	5693
    Tucson	9243
    Tulsa	8818
    Tunis	9231
    Tupelo	9077
    Ulan-bator	4994
    Vancouver	6968
    Vienna	8451
    Vientiane	9209
    Waco	9175
    Warsaw	8059
    Washington	17749
    Washington DC	17749
    West Palm Beach	9239
    Wichita	8457
    Wichita Falls	9034
    Wilkes Barre	7870
    Wilmington	5294
    Windhoek	8641
    Winnipeg	4459
    Yakima	8381
    Yerevan	2862
    Youngstown	7725
    Yuma	4086
    Zagreb	8296
    Zurich	8540


# Ejercicio 4:

rango de temperaturas por ciudad (Min/Max)
Encuentra la temperatura mínima y máxima registrada para cada región.


```python
%%writefile mapper_ejercicio4.py
#!/usr/bin/env python3


import os
import sys


for line in sys.stdin:
    # line = "Africa,Algeria,,Algiers,1,1,1995,64.2"
    line = line.strip()
    region, country, state, city, month, day, year, avg_temperature  = line.split(',')

    print( f"{city}\t{avg_temperature}")
#Creamos una serie de pares claves-valor city-temperatura
```

    Writing mapper_ejercicio4.py



```python
%%writefile reducer_ejercicio4.py
#!/usr/bin/env python3

import sys
ciudad_test = None
temperatura_testMax = None
temperatura_testMin = None
for line in sys.stdin:
    city, avg_temperature = line.strip().split("\t",1)
    if avg_temperature == "AvgTemperature":
        continue
    else:
        avg_temperature = float(avg_temperature)
    if avg_temperature == -99.0: #Ponemos esta condición ya que si hay valores faltantes de temperatura, podrá, -99(me di cuenta pk todos los valores negativos eran -99)
        continue
    if ciudad_test is None:
        #Si la ciudad es la primera
        ciudad_test = city
        temperatura_testMax = avg_temperature
        temperatura_testMin = avg_temperature
    if city == ciudad_test:
        #Misma ciudad, comprobar temperatura, en caso de ser mayor cambiarla
        if avg_temperature > temperatura_testMax:
            temperatura_testMax = avg_temperature
        if avg_temperature < temperatura_testMin:
            temperatura_testMin = avg_temperature
    else:
        #Distinta ciudad, imprimimos la anterior con sus valores max y min
        print(f"{ciudad_test}\t{temperatura_testMax}\t {temperatura_testMin}")
        #Seteamos las variables a las nuevas
        ciudad_test = city
        temperatura_testMax = avg_temperature
        temperatura_testMin = avg_temperature
        
if ciudad_test is not None:
    #Ultima línea
    print(f"{ciudad_test}\t{temperatura_testMax}\t {temperatura_testMin}")
```

    Overwriting reducer_ejercicio4.py


Simulamos para comprobar los resultados


```python
# Simulamos para ver si funciona los scripts creados (El sort simula el shuffle)
!head -n 30000 city_temperature.csv | python3 mapper_ejercicio4.py | sort | python3 reducer_ejercicio4.py
```

    Algiers	96.6	 33.3
    Bangui	93.7	 59.9
    Bujumbura	89.1	 48.2
    Cotonou	88.6	 56.4


Una vez comprobado el funcionamiento, hacemos el STREAMING


```python
!hadoop jar \
/usr/local/hadoop/share/hadoop/tools/lib/hadoop-streaming-3.4.0.jar \
-file mapper_ejercicio4.py \
-file reducer_ejercicio4.py \
-mapper mapper_ejercicio4.py \
-reducer reducer_ejercicio4.py \
-input /practica/city_temperature.csv \
-output /Temperatura_MinMax
```

    2025-11-24 11:45:02,341 WARN streaming.StreamJob: -file option is deprecated, please use generic option -files instead.
    packageJobJar: [mapper_ejercicio4.py, reducer_ejercicio4.py, /tmp/hadoop-unjar2014823305985027630/] [] /tmp/streamjob5376113274419945431.jar tmpDir=null
    2025-11-24 11:45:02,906 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at yarnmanager/172.19.0.7:8032
    2025-11-24 11:45:02,993 INFO client.DefaultNoHARMFailoverProxyProvider: Connecting to ResourceManager at yarnmanager/172.19.0.7:8032
    2025-11-24 11:45:03,155 INFO mapreduce.JobResourceUploader: Disabling Erasure Coding for path: /tmp/hadoop-yarn/staging/root/.staging/job_1763979698295_0006
    2025-11-24 11:45:03,403 INFO mapred.FileInputFormat: Total input files to process : 1
    2025-11-24 11:45:03,413 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.3:9866
    2025-11-24 11:45:03,413 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.5:9866
    2025-11-24 11:45:03,413 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.4:9866
    2025-11-24 11:45:03,413 INFO net.NetworkTopology: Adding a new node: /default-rack/172.19.0.6:9866
    2025-11-24 11:45:03,451 INFO mapreduce.JobSubmitter: number of splits:2
    2025-11-24 11:45:03,515 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1763979698295_0006
    2025-11-24 11:45:03,515 INFO mapreduce.JobSubmitter: Executing with tokens: []
    2025-11-24 11:45:03,620 INFO conf.Configuration: resource-types.xml not found
    2025-11-24 11:45:03,620 INFO resource.ResourceUtils: Unable to find 'resource-types.xml'.
    2025-11-24 11:45:03,665 INFO impl.YarnClientImpl: Submitted application application_1763979698295_0006
    2025-11-24 11:45:03,688 INFO mapreduce.Job: The url to track the job: http://yarnmanager:8088/proxy/application_1763979698295_0006/
    2025-11-24 11:45:03,689 INFO mapreduce.Job: Running job: job_1763979698295_0006
    2025-11-24 11:45:07,756 INFO mapreduce.Job: Job job_1763979698295_0006 running in uber mode : false
    2025-11-24 11:45:07,758 INFO mapreduce.Job:  map 0% reduce 0%
    2025-11-24 11:45:12,811 INFO mapreduce.Job:  map 100% reduce 0%
    2025-11-24 11:45:18,793 INFO mapreduce.Job:  map 100% reduce 100%
    2025-11-24 11:45:19,812 INFO mapreduce.Job: Job job_1763979698295_0006 completed successfully
    2025-11-24 11:45:19,872 INFO mapreduce.Job: Counters: 54
    	File System Counters
    		FILE: Number of bytes read=47411269
    		FILE: Number of bytes written=95765152
    		FILE: Number of read operations=0
    		FILE: Number of large read operations=0
    		FILE: Number of write operations=0
    		HDFS: Number of bytes read=140605132
    		HDFS: Number of bytes written=6541
    		HDFS: Number of read operations=11
    		HDFS: Number of large read operations=0
    		HDFS: Number of write operations=2
    		HDFS: Number of bytes read erasure-coded=0
    	Job Counters 
    		Launched map tasks=2
    		Launched reduce tasks=1
    		Data-local map tasks=2
    		Total time spent by all maps in occupied slots (ms)=6207
    		Total time spent by all reduces in occupied slots (ms)=3381
    		Total time spent by all map tasks (ms)=6207
    		Total time spent by all reduce tasks (ms)=3381
    		Total vcore-milliseconds taken by all map tasks=6207
    		Total vcore-milliseconds taken by all reduce tasks=3381
    		Total megabyte-milliseconds taken by all map tasks=6355968
    		Total megabyte-milliseconds taken by all reduce tasks=3462144
    	Map-Reduce Framework
    		Map input records=2906328
    		Map output records=2906328
    		Map output bytes=41598607
    		Map output materialized bytes=47411275
    		Input split bytes=204
    		Combine input records=0
    		Combine output records=0
    		Reduce input groups=322
    		Reduce shuffle bytes=47411275
    		Reduce input records=2906328
    		Reduce output records=321
    		Spilled Records=5812656
    		Shuffled Maps =2
    		Failed Shuffles=0
    		Merged Map outputs=2
    		GC time elapsed (ms)=169
    		CPU time spent (ms)=6820
    		Physical memory (bytes) snapshot=952098816
    		Virtual memory (bytes) snapshot=7853907968
    		Total committed heap usage (bytes)=1002438656
    		Peak Map Physical memory (bytes)=286224384
    		Peak Map Virtual memory (bytes)=2614595584
    		Peak Reduce Physical memory (bytes)=381632512
    		Peak Reduce Virtual memory (bytes)=2626314240
    	Shuffle Errors
    		BAD_ID=0
    		CONNECTION=0
    		IO_ERROR=0
    		WRONG_LENGTH=0
    		WRONG_MAP=0
    		WRONG_REDUCE=0
    	File Input Format Counters 
    		Bytes Read=140604928
    	File Output Format Counters 
    		Bytes Written=6541
    2025-11-24 11:45:19,872 INFO streaming.StreamJob: Output directory: /Temperatura_MinMax



```python
!hdfs dfs -ls /Temperatura_MinMax
```

    Found 2 items
    -rw-r--r--   3 root supergroup          0 2025-11-24 11:45 /Temperatura_MinMax/_SUCCESS
    -rw-r--r--   3 root supergroup       6541 2025-11-24 11:45 /Temperatura_MinMax/part-00000



```python
!hdfs dfs -cat /Temperatura_MinMax/part-00000
```

    Abidjan	88.6	 40.3
    Abilene	94.2	 13.5
    Abu Dhabi	107.3	 55.8
    Addis Ababa	77.0	 50.4
    Akron Canton	86.1	 -6.1
    Albany	88.0	 -5.4
    Albuquerque	89.4	 3.0
    Algiers	96.6	 33.3
    Allentown	91.1	 4.0
    Almaty	90.9	 -14.2
    Amarillo	92.5	 2.1
    Amman	95.4	 33.3
    Amsterdam	85.5	 11.0
    Anchorage	75.3	 -19.6
    Ankara	87.9	 3.2
    Antananarivo	78.5	 33.8
    Ashabad	102.2	 6.8
    Asheville	85.1	 6.6
    Athens	94.3	 28.4
    Atlanta	92.8	 13.7
    Atlantic City	93.3	 4.6
    Auckland	75.4	 41.1
    Austin	94.5	 22.1
    Baltimore	91.9	 9.0
    Bangkok	93.0	 63.0
    Bangui	93.7	 59.9
    Banjul	93.6	 64.6
    Barcelona	86.6	 32.6
    Baton Rouge	90.2	 22.5
    Beijing	92.9	 5.2
    Beirut	91.1	 44.5
    Belfast	77.6	 12.5
    Belgrade	91.9	 1.4
    Belize City	92.9	 64.6
    Bern	83.7	 4.7
    Bilbao	94.6	 30.8
    Billings	90.6	 -22.0
    Birmingham	91.0	 11.1
    Bishkek	91.1	 -10.8
    Bismarck	91.7	 -28.1
    Bissau	100.1	 65.4
    Bogota	66.7	 46.7
    Boise	94.2	 -0.5
    Bombay (Mumbai)	92.6	 63.4
    Bonn	86.9	 4.7
    Bordeaux	88.8	 21.7
    Boston	90.7	 0.2
    Brasilia	87.7	 56.1
    Bratislava	85.5	 5.6
    Brazzaville	88.7	 61.2
    Bridgeport	87.0	 3.2
    Bridgetown	88.0	 74.2
    Brisbane	87.3	 45.6
    Brownsville	91.2	 31.4
    Brussels	85.4	 8.8
    Bucharest	91.4	 1.9
    Budapest	88.2	 7.3
    Buenos Aires	90.9	 35.3
    Buffalo	84.4	 -4.6
    Bujumbura	89.1	 48.2
    Burlington	88.8	 -14.1
    Cairo	100.2	 45.2
    Calcutta	96.8	 52.9
    Calgary	79.1	 -27.9
    Canberra	93.2	 30.7
    Capetown	83.8	 44.9
    Caracas	89.9	 71.5
    Caribou	83.4	 -20.9
    Casper	87.1	 -18.1
    Charleston	91.6	 1.8
    Charlotte	90.4	 15.6
    Chattanooga	92.7	 10.3
    Chengdu	90.6	 31.9
    Chennai (Madras)	97.9	 69.7
    Cheyenne	84.7	 -12.0
    Chicago	92.3	 -16.4
    Cincinnati	89.2	 -2.2
    Cleveland	87.2	 -5.9
    Colombo	88.3	 70.3
    Colorado Springs	86.4	 -7.7
    Columbia	92.8	 21.8
    Columbus	97.7	 -3.8
    Conakry	89.6	 65.2
    Concord	90.1	 -5.0
    Copenhagen	77.5	 9.3
    Corpus Christi	93.0	 29.5
    Cotonou	88.6	 56.4
    Dakar	87.0	 63.2
    Dallas Ft Worth	98.2	 16.1
    Damascus	95.5	 26.8
    Dar Es Salaam	90.4	 65.0
    Dayton	91.2	 -6.6
    Daytona Beach	87.8	 32.5
    Delhi	103.7	 43.9
    Denver	88.3	 -11.0
    Des Moines	93.0	 -17.8
    Detroit	88.6	 -12.4
    Dhahran	107.8	 46.1
    Dhaka	91.4	 54.3
    Doha	108.5	 49.6
    Dubai	107.5	 58.7
    Dublin	70.1	 17.1
    Duluth	85.6	 -29.8
    Dusanbe	97.6	 7.5
    Edmonton	82.8	 -29.2
    El Paso	98.1	 8.4
    Elkins	92.5	 -4.2
    Erie	86.4	 -5.9
    Eugene	85.4	 4.2
    Evansville	91.5	 -0.7
    Fairbanks	79.5	 -50.0
    Fargo	91.4	 -29.5
    Flagstaff	83.5	 10.2
    Flint	89.4	 -13.2
    Fort Smith	100.7	 11.9
    Fort Wayne	89.4	 -10.4
    Frankfurt	85.2	 13.0
    Freetown	88.7	 57.8
    Fresno	102.6	 27.6
    Geneva	85.2	 15.3
    Georgetown	90.6	 67.0
    Goodland	91.8	 -5.6
    Grand Junction	92.3	 -2.3
    Grand Rapids	89.1	 -7.3
    Great Falls	100.1	 -24.1
    Green Bay	91.3	 -21.2
    Greensboro	90.4	 10.8
    Guadalajara	88.5	 45.8
    Guangzhou	94.7	 38.7
    Guatemala City	79.8	 51.2
    Guayaquil	90.0	 67.2
    Halifax	80.5	 -7.8
    Hamburg	89.8	 13.5
    Hamilton	85.4	 51.1
    Hanoi	96.0	 44.7
    Harrisburg	92.0	 8.7
    Hartford Springfield	89.8	 -2.1
    Havana	88.3	 46.9
    Helena	89.3	 -26.4
    Helsinki	79.8	 -13.6
    Hong Kong	92.4	 40.2
    Honolulu	87.2	 65.7
    Houston	93.0	 25.9
    Huntsville	91.5	 7.8
    Indianapolis	94.0	 -7.8
    Islamabad	102.4	 36.2
    Istanbul	88.7	 24.1
    Jackson	89.6	 15.1
    Jacksonville	88.3	 28.7
    Jakarta	90.6	 71.3
    Juneau	72.0	 -4.1
    Kampala	82.9	 64.4
    Kansas City	92.6	 -6.1
    Karachi	99.7	 52.2
    Katmandu	86.6	 36.6
    Kiev	86.9	 -11.1
    Knoxville	91.7	 4.9
    Kuala Lumpur	89.6	 73.4
    Kuwait	110.0	 41.4
    La Paz	63.4	 32.8
    Lagos	93.2	 71.6
    Lake Charles	94.0	 26.4
    Lansing	88.1	 -13.4
    Las Vegas	107.0	 30.4
    Lexington	89.5	 -0.9
    Libreville	86.8	 40.6
    Lilongwe	90.7	 50.9
    Lima	81.8	 57.5
    Lincoln	91.9	 -12.0
    Lisbon	96.3	 39.0
    Little Rock	95.4	 12.5
    Lome	90.1	 69.6
    London	83.4	 24.6
    Los Angeles	86.0	 44.8
    Louisville	93.2	 1.7
    Lubbock	94.1	 6.7
    Lusaka	93.2	 47.8
    Macon	91.1	 18.8
    Madison	90.6	 -20.0
    Madrid	91.0	 24.9
    Managua	93.9	 68.5
    Manama	103.3	 50.5
    Manila	91.9	 70.9
    Maputo	95.6	 53.2
    Medford	97.3	 13.1
    Melbourne	92.8	 45.7
    Memphis	93.6	 10.1
    Mexico City	77.0	 43.0
    Miami Beach	89.2	 40.0
    Midland Odessa	94.6	 11.4
    Milan	87.4	 14.3
    Milwaukee	92.2	 -16.6
    Minneapolis St. Paul	92.0	 -23.8
    Minsk	83.5	 -15.8
    Mobile	88.9	 21.9
    Monterrey	103.4	 28.6
    Montgomery	91.2	 18.4
    Montreal	84.6	 -14.4
    Montvideo	87.4	 35.7
    Moscow	87.3	 -20.4
    Munich	81.8	 1.8
    Muscat	105.9	 60.7
    Nairobi	82.4	 51.8
    Nashville	94.1	 4.4
    Nassau	91.8	 58.7
    New Orleans	90.1	 26.1
    New York City	93.7	 8.3
    Newark	95.6	 7.6
    Niamey	102.8	 63.5
    Nicosia	102.5	 33.9
    Norfolk	93.2	 14.8
    North Platte	91.1	 -9.0
    Nouakchott	99.5	 58.3
    Oklahoma City	97.1	 7.2
    Omaha	93.2	 -13.4
    Orlando	89.3	 34.7
    Osaka	93.0	 27.8
    Oslo	77.1	 -8.7
    Ottawa	84.9	 -15.4
    Paducah	91.8	 1.6
    Panama City	90.6	 73.4
    Paramaribo	90.5	 71.6
    Paris	91.5	 13.8
    Peoria	90.5	 -13.7
    Perth	95.2	 43.1
    Philadelphia	92.9	 9.4
    Phoenix	107.7	 37.3
    Pittsburgh	88.4	 -4.6
    Pocatello	90.4	 -9.2
    Port au Prince	97.4	 71.4
    Portland	89.4	 -3.7
    Prague	83.6	 -3.1
    Pristina	89.6	 -3.3
    Pueblo	94.7	 -7.3
    Pyongyang	89.4	 -4.7
    Quebec	82.9	 -20.5
    Quito	69.0	 49.1
    Rabat	97.0	 33.8
    Raleigh Durham	91.0	 11.6
    Rangoon	99.3	 50.9
    Rapid City	91.9	 -19.0
    Regina	83.2	 -36.5
    Reno	92.8	 5.4
    Reykjavik	69.7	 10.6
    Rhode Island	89.2	 0.3
    Richmond	93.5	 9.8
    Riga	81.2	 -12.1
    Rio de Janeiro	93.4	 60.0
    Riyadh	105.0	 38.0
    Roanoke	91.1	 7.9
    Rochester	86.2	 -2.3
    Rockford	90.6	 -20.0
    Rome	85.8	 31.0
    Sacramento	96.3	 29.8
    Salem	90.5	 17.9
    Salt Lake City	92.2	 2.8
    San Angelo	96.3	 16.5
    San Antonio	95.4	 23.0
    San Diego	86.5	 45.1
    San Francisco	82.7	 38.3
    San Jose	85.6	 63.1
    San Juan Puerto Rico	89.2	 69.7
    Santo Domingo	87.4	 65.0
    Sao Paulo	89.2	 44.8
    Sapporo	82.5	 -1.7
    Sault Ste Marie	80.6	 -15.1
    Savannah	89.1	 26.7
    Seattle	87.7	 20.1
    Seoul	90.0	 -0.6
    Shanghai	96.8	 21.8
    Shenyang	90.7	 -17.0
    Shreveport	95.4	 20.3
    Singapore	88.5	 73.3
    Sioux City	90.7	 -16.3
    Sioux Falls	94.3	 -22.2
    Skopje	88.0	 0.3
    Sofia	86.0	 2.6
    South Bend	89.4	 -15.6
    Spokane	93.2	 -9.4
    Springfield	92.8	 -11.8
    St Louis	96.3	 -5.2
    Stockholm	79.2	 -5.0
    Sydney	96.8	 39.5
    Syracuse	87.5	 -9.8
    Taipei	94.0	 41.5
    Tallahassee	92.8	 27.0
    Tampa St. Petersburg	90.8	 34.0
    Tashkent	95.4	 3.8
    Tbilisi	90.6	 14.7
    Tegucigalpa	88.0	 56.1
    Tel Aviv	88.5	 45.1
    Tirana	92.5	 24.9
    Tokyo	90.6	 32.3
    Toledo	89.8	 -10.1
    Topeka	95.6	 -2.7
    Toronto	88.8	 -5.4
    Tucson	101.6	 27.6
    Tulsa	100.4	 4.2
    Tunis	96.4	 36.6
    Tupelo	92.8	 10.6
    Ulan-bator	87.5	 -37.2
    Vancouver	83.1	 14.2
    Vienna	86.2	 3.8
    Vientiane	97.0	 51.4
    Waco	96.1	 18.5
    Warsaw	84.4	 -8.1
    Washington	92.8	 11.9
    Washington DC	92.8	 11.9
    West Palm Beach	89.3	 38.5
    Wichita	96.1	 1.3
    Wichita Falls	98.5	 10.6
    Wilkes Barre	88.4	 -1.0
    Wilmington	89.7	 7.6
    Windhoek	92.2	 38.8
    Winnipeg	86.6	 -35.7
    Yakima	97.7	 -5.9
    Yerevan	91.8	 -8.8
    Youngstown	86.7	 -6.4
    Yuma	107.5	 45.3
    Zagreb	87.5	 10.2
    Zurich	82.4	 7.8

